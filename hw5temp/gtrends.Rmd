---
title: "Coronavirus Google Trends Tracker"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard); library(gtrendsR); library(plotly); library(dplyr)
```

Inputs {.sidebar}
-------------------------------------

Compare Google search results for "coronavirus" to:
```{r}
# see coronavirus search alone

textInput("search", "Search term:", value = "virus")

selectInput("time", "in the past: ",
                c("Past hour" = "now 1-H",
                  "Past day"= "now 1-d",
                  "Past 7 days" = "now 7-d",
                  "Past 30 days" = "today 1-m",
                  "Past 90 days" = "today 3-m",
                  "Past 12 months" = "today 12-m",
                  "Past 5 years" = "today+5-y"
                  ), selected = "Past hour")

selectInput("source", "from: ",
            c("all web" = "web",
              "news" = "news",
              "YouTube" = "youtube",
              "images" = "images",
              "Froogle" = "froogle"
            )
  
)

submitButton("Update") # NEED TO FIX

```
 

Row
-----------------------------------------------------------------------

### Interest over time

```{r comparison}

renderPlotly({
  y = gtrends(c("coronavirus", input$search), time = input$time, gprop = input$source)
  plot(y)
})

```

Row
-----------------------------------------------------------------------

### Related queries

```{r related queries}
# Related queries
renderPlotly({
  x = gtrends("coronavirus", time = input$time, gprop = input$source)
  
  queries = x$related_queries %>% filter(subject >= 1)
  queries$subject = as.numeric(queries$subject) # make number
  queries = na.omit(queries)
  
  queries$value <- factor(queries$value, levels = unique(queries$value)[order(queries$subject, decreasing = FALSE)]) # order
  
  plot_ly(queries, x = ~subject, y = ~value, type = 'bar', name = "Related queries", marker = list(color = '#9119b8')) 
    
})

```

