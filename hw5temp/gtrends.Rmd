---
title: "Coronavirus Google Trends"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard); library(gtrendsR); library(plotly); library(dplyr)
```

Inputs {.sidebar}
-------------------------------------

```{r}
# see coronavirus search alone

textInput("search", "Search term:", value = "flu")

selectInput("time", "Time range: ",
                c("Past hour" = "now 1-H",
                  "Past day"= "now 1-d",
                  "Past 7 days" = "now 7-d",
                  "Past 30 days" = "today 1-m",
                  "Past 90 days" = "today 3-m",
                  "Past 12 months" = "today 12-m",
                  "Past 5 years" = "today+5-y"
                  ), selected = "Past hour")

submitButton("Update")

```
 

Row
-----------------------------------------------------------------------

### Interest over time - Coron

```{r comparison}


renderPlotly({
  if (is.null(input$search)) {
    y = gtrends("coronavirus", time = input$time)
  } else {
    y = gtrends(c("coronavirus", input$search), time = input$time)
  }
  plot(y)
})
```

Row {.tabset .tabset-fade}
-----------------------------------------------------------------------

### Related topics

```{r related topics}
x = gtrends("coronavirus", time = "today 3-m") # last hour


# Related topics
renderPlotly({
  
  related = x$related_topics %>% filter(subject > 0) # need to only take numbers
  related$subject = as.numeric(related$subject)
  related = na.omit(related)
  
  related$value <- factor(related$value, levels = unique(related$value)[order(related$subject, decreasing = FALSE)]) # order

  plot_ly(related, x = ~subject, y = ~value, type = 'bar') 

  })


```

### Related queries

```{r related queries}
# Related queries
renderPlotly({
  queries = x$related_queries %>% filter(subject >= 0)
  queries$subject = as.numeric(queries$subject) # make number
  
  queries$value <- factor(queries$value, levels = unique(queries$value)[order(queries$subject, decreasing = FALSE)]) # order
  
  plot_ly(queries, x = ~subject, y = ~value, type = 'bar', name = "Related queries", marker = list(color = '#9119b8')) 
    
})


```

